---
title: "Bias Analysis in Human Resource System"
author: "Report prepared for Black Saber Software by Data Over Flow"
date: '2021-04-21'
output:
  pdf_document:
    template: report.tex
    toc: yes
    toc_depth: 2
  word_document:
    toc: yes
    toc_depth: '2'
  html_document:
    df_print: paged
    toc: yes
    toc_depth: '2'
subtitle: "-for Blacksaber Software in 2021"
lang: en
titlepage: yes
titlepage-color: 027FFF
titlepage-rule-color: FFFFFF
titlepage-rule-height: 2
titlepage-text-color: FFFFFF
---

```{r setup, include = FALSE}
library(lmtest)
library(tidyverse)
library(cowplot)
library(lme4)
library(ggpubr)
library(knitr)
# this should supress all code and messages
knitr::opts_chunk$set(echo = FALSE, message = FALSE)
```

```{r, warning=FALSE}
# Import cleaned data
current <- read_csv("clean/current.csv")
final_hires <- read_csv("clean/final-hires-newgrad_2020.csv")
phase1_new_applicants <- read_csv("clean/phase1_new.csv")
phase2_new_applicants <- read_csv("clean/phase2_new.csv")
phase3_new_applicants <- read_csv("clean/phase3_new.csv")
```

\newpage
# Executive summary

We (Data Over Flow Co.Ltd.) have examined the structure of human resource system of the company (the Black Saber Software) by analyzing data on the company's hiring, promotion and salary process and found there to be no bias. 

In our opinion, the system is fair during each of the three process, in accordance with Ontario's Human Rights Code and Black Saber's policies. Specifically, neither hiring nor promition process shows sign of gender/racial discrimination; the individual salary level is fairly evaluated based non-personal and work-related parameters only.  


\newpage
# Technical report

## Introduction

### Research questions

*
*
*

## Does there exist bias in current employee enumeration?

```{r}
# The main model examine the gender bias, along with other potential biases in current employee remuneration
# fixed effect: gender, seniority, quarter 
# random effect: team, leadership, productivity 
model1 <- lmer(salary ~ gender + role_seniority + financial_q + (1|team) + (1| leadership_for_level) + (1|productivity), data = current)
summary(model1)
```
```{r}
# The reduced model from the main model, took productivity out from random effect
# fixed effect: gender, seniority, quarter 
# random effect: team, leadership
model2 <- lmer(salary ~ gender + role_seniority + financial_q + (1|team) + (1| leadership_for_level), data = current)
summary(model2)
# Likelihood ratio test comparing the two models, small p value indicating the second model is better
lmtest::lrtest(model1, model2)
```

```{r}
# The reduced model from the main model, took productivity and team out from random effect
# fixed effect: gender, seniority, quarter 
# random effect: leadership
model3 <- lmer(salary ~ gender + role_seniority + financial_q + (1| leadership_for_level), data = current)
#summary(model3)
# Likelihood ratio test comparing the two models, small p value indicating the second model is better
lmtest::lrtest(model2, model3)
```

```{r}
# The reduced model from the main model, took productivity and leadership out from random effect
# fixed effect: gender, seniority, quarter 
# random effect: team
model4 <- lmer(salary ~ gender + role_seniority + financial_q + (1| team), data = current)
#summary(model3)
# Likelihood ratio test comparing the two models, small p value indicating the second model is better
lmtest::lrtest(model3, model4)
```

_For each research question, you will want to briefly describe any data manipulation, show some exploratory plots/summary tables, report on any methods you use (i.e. models you fit) and the conclusions you draw from these_

## Does there exist bias in the hiring process?

```{r}
# pass_phase1 ~ gender* cv gpa cover_letter (phase1)
model2.1 <- glm(pass_phase1 ~ gender + gpa + extracurriculars + cv + work_experience, family = binomial(link = "logit"), data = phase1_new_applicants)
summary(model2.1)
```
```{r}
# pass_phase2 ~ gender* cv gpa cover_letter tech writing speaking (phase2)
# everyone passed phase 1 has cv
model2.2 <- glm(pass_phase2 ~ gender + team_applied_for + cover_letter + extracurriculars + work_experience + technical_skills + writing_skills + leadership_presence + speaking_skills, family = binomial(link = "logit"), data = phase2_new_applicants)
summary(model2.2)
```
```{r}
# final_hired ~ gender* cv gpa cover_letter tech writing speaking rating1 rating2 (phase3)
# everyone passed phase 1 has cv
# too few datapoints model can't converge... the only model that can converge is to use gender 
phase3_new_applicants <- phase3_new_applicants %>% mutate(avg = (interviewer_rating_1+interviewer_rating_2)/2)
model2.3 <- glm(final_hired ~ gender, family = binomial(link = "logit"), data = phase3_new_applicants)
summary(model2.3)
#table(phase3_new_applicants$gender, phase3_new_applicants$final_hired)
table(phase3_new_applicants$avg)
```

_For each research question, you will want to briefly describe any data manipulation, show some exploratory plots/summary tables, report on any methods you use (i.e. models you fit) and the conclusions you draw from these_

## Informative title for section addressing a research question

_For each research question, you will want to briefly describe any data manipulation, show some exploratory plots/summary tables, report on any methods you use (i.e. models you fit) and the conclusions you draw from these_

## Data Visualization

```{r gender salary, fig.cap="Salary Distribution for Men and Women in Each Quarter", fig.align='center', fig.height=7}
#edit axis label (name)
salary_by_gender_q1 <- current %>% filter(substring(financial_q, nchar(financial_q)) == '1') %>% ggplot(aes(x = gender, y = salary)) + geom_boxplot(aes(colour = gender)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
salary_by_gender_q2 <- current %>% filter(substring(financial_q, nchar(financial_q)) == '1') %>% ggplot(aes(x = gender, y = salary)) + geom_boxplot(aes(colour = gender)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
salary_by_gender_q3 <- current %>% filter(substring(financial_q, nchar(financial_q)) == '1') %>% ggplot(aes(x = gender, y = salary)) + geom_boxplot(aes(colour = gender))+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
salary_by_gender_q4 <- current %>% filter(substring(financial_q, nchar(financial_q)) == '1') %>% ggplot(aes(x = gender, y = salary)) + geom_boxplot(aes(colour = gender))+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
gender_salary <- plot_grid(salary_by_gender_q1, salary_by_gender_q2, salary_by_gender_q3, salary_by_gender_q4, labels = c("Q1","Q2","Q3","Q4"), ncol = 2, nrow = 2)
gender_salary
```

```{r fig1, fig.cap="Salary Difference Across Leadership for Level Fixing Productivity", fig.align='center'}
ldr_slry <- current %>% 
  filter(financial_q == '2020 Q1') %>% 
  group_by(employee_id) %>% 
  ggplot(aes(x = productivity, y = salary, color = as.factor(leadership_for_level)))+
  geom_point()+
  labs(color = "Leadership for Level")
ldr_slry
```

```{r, message=FALSE, fig.cap="Salary Difference Across Role Seniority", fig.align='center'}
lvl_slry <- current %>% 
  filter(financial_q == '2020 Q1') %>% 
  group_by(employee_id) %>% 
  ggplot(aes(x = productivity, y = salary, color = as.factor(role_seniority)))+
  geom_point()+
    labs(color = "Seniority")
lvl_slry
```

```{r, message=FALSE, fig.cap="Salary Difference Across Leadership Levels"}
pro_slry <- current %>% 
  filter(financial_q == '2020 Q1') %>% 
  group_by(employee_id) %>% 
  ggplot(aes(x = productivity, y = salary, color = as.factor(gender)))+
  geom_point()+
  labs(color = "gender")
pro_slry
```


```{r, fig.cap="Salary Difference in Gender Across Teams, Fixing Quater and Seniority(Entry Level)"}
current %>% 
  filter(financial_q == '2020 Q4') %>% 
  filter(role_seniority == 'Entry-level') %>% 
  group_by(employee_id) %>% 
  ggplot(aes(x = team, y = salary, color = as.factor(gender)))+
  geom_point()+ theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))+
  labs(color = "gender")
#ggsave("images/leadership_salary_Q1.png", width = 7, height = 4)
```


```{r, fig.cap="Salary Difference in Gender Across Teams, Fixing Quater and Seniority(Junior I)"}
current %>% 
  filter(financial_q == '2020 Q4') %>% 
  filter(role_seniority == 'Junior I') %>% 
  group_by(employee_id) %>% 
  ggplot(aes(x = team, y = salary, color = as.factor(gender)))+
  geom_point()+ theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))+
  labs(color = "gender")
```


```{r, fig.cap="Salary Difference in Gender Across Teams, Fixing Quater and Seniority(Junior II)"}
current %>% 
  filter(financial_q == '2020 Q4') %>% 
  filter(role_seniority == 'Senior I') %>% 
  group_by(employee_id) %>% 
  ggplot(aes(x = team, y = salary, color = as.factor(gender)))+
  geom_point()+ theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))+
  labs(color = "gender")
```


```{r, fig.cap="Salary Difference in Gender Across Teams, Fixing Quater and Seniority(Manager)"}
current %>% 
  filter(financial_q == '2020 Q4') %>% 
  filter(role_seniority == 'Manager') %>% 
  group_by(employee_id) %>% 
  ggplot(aes(x = team, y = salary, color = as.factor(gender)))+
  geom_point()+ theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))+
  labs(color = "gender")
```

```{r, fig.cap="Salary Difference in Gender Across Leadership for Level"}
current %>% 
  group_by(employee_id) %>% 
  ggplot(aes(x = leadership_for_level, y = salary, color = as.factor(gender)))+
  geom_point()+
  labs(color = "gender")+
  xlab("leadership for level")+ theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))+
  labs(color = "gender")
```


```{r, fig.cap="Salary Difference in Gender Across Seniority"}
current %>% 
  group_by(employee_id) %>% 
  ggplot(aes(x = role_seniority, y = salary, color = as.factor(gender)))+
  geom_point()+ theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))+
  labs(color = "gender")+
  xlab("seniority")
```

```{r, fig.cap="Salary Difference in Gender Across Teams"}
current %>% 
  group_by(employee_id) %>% 
  ggplot(aes(x = team, y = salary, color = as.factor(gender)))+
  geom_point()+ theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))+
  labs(color = "gender")
```

```{r, fig.cap="GPA Distribution Across Phase1 Applicants"}
phase1_new_applicants %>% ggplot(aes(x = as.character(gender), y = gpa)) + geom_boxplot()+
  xlab("gender")
#ggsave("images/gpa_hiring.png", gpa_if_hired)
```


```{r, fig.cap="GPA Distribtion Across Hiring Results"}
gpa_if_hired <- phase1_new_applicants %>% ggplot(aes(x = as.character(final_hired), y = gpa)) + geom_boxplot()+
  xlab("hiring results")
gpa_if_hired
```

```{r, fig.cap="GPA Distribution Across Phase1 Results"}
gpa_if_pass_phase1 <- phase1_new_applicants %>% ggplot(aes(x = as.character(pass_phase1), y = gpa)) + geom_boxplot()+
  xlab("phase1 results")
gpa_if_pass_phase1
```

```{r, fig.cap="Speaking Skills Score Across Hiring Results"}
#same scale 
phase2_new_applicants %>% ggplot(aes(x = as.character(final_hired), y = speaking_skills)) + geom_boxplot()+
  xlab("hiring results")+ylab("speaking skills score")
```

```{r, fig.cap="Speaking Skills Score Across Phase2 Results"}
#same scale 
phase2_new_applicants %>% ggplot(aes(x = as.character(pass_phase2), y = speaking_skills)) + geom_boxplot()+
  xlab("phase2 results")+ylab("speaking skills score")
```

### Writing Skills VS if hired
```{r, fig.cap="Writing Skills Score Across Hiring Results"}
phase2_new_applicants %>% ggplot(aes(x = as.character(final_hired), y = writing_skills)) + geom_boxplot()+
  xlab("hiring results")+ylab("writing skills score")
```
![](images/writing_hired.png)
```{r, fig.cap="Writing Skills Score Across Phase2 Results"}
phase2_new_applicants %>% ggplot(aes(x = as.character(pass_phase2), y = writing_skills)) + geom_boxplot()+
  xlab("phase2 results")+ylab("writing skills score")
```


```{r, fig.cap="Technical Skills Score Across Hiring Results"}
phase2_new_applicants %>% ggplot(aes(x = as.character(final_hired), y = technical_skills)) + geom_boxplot()+
  xlab("hiring results")+ylab("technical skills score")
```


```{r}
phase1_new_applicants %>% 
  filter(final_hired == '1') %>% 
  group_by(applicant_id) %>% 
  ggplot(aes(x = gender, y = gpa))+
  geom_point()
```


```{r}
phase2_new_applicants %>% 
  filter(final_hired == '1') %>% 
  group_by(applicant_id) %>% 
  ggplot(aes(x = gender, y = technical_skills))+
  geom_point()
```


```{r}
phase2_new_applicants %>% 
  filter(final_hired == '1') %>% 
  group_by(applicant_id) %>% 
  ggplot(aes(x = gender, y = writing_skills))+
  geom_point()
```


```{r}
phase2_new_applicants %>% 
  filter(final_hired == '1') %>% 
  group_by(applicant_id) %>% 
  ggplot(aes(x = gender, y = speaking_skills))+
  geom_point()

```



## Discussion

_In this section you will summarize your findings across all the research questions and discuss the strengths and limitations of your work. It doesn't have to be long, but keep in mind that often people will just skim the intro and the discussion of a document like this, so make sure it is useful as a semi-standalone section (doesn't have to be completely standalone like the executive summary)._

### Strengths and limitations
- Dataset size tooooo small!! especially the final hired data and the phase 3 data (22 observations)



\newpage
# Consultant information
## Consultant profiles

**Rain Wu**. Rain is a senior consultant with DataOverFlow. She specializes in data visualization. Rain earned her Bachelor of Science, Specialist in Statistics Methods and Practice, from the University of Toronto in 2022. Before joining DataOverFlow, Rain has 3 year of working experience as a data engineer at Aviva in Markham, Toronto. 

**Tina Wang**. Tina is a junior consultant with DataOverFlow. She specializes in reproducible analysis. Tina earned her Bachelor of Science, Majoring in Computer Science and Statistics from the University of Toronto in 2022. Tina earned her master degree in financial insurance from the University of Toronto in 2024.

**Yiqu Ding**. Yiqu is a junior consultant with DataOverFlow. She specializes in statistical communication. Yiqu earned her Bachelor of Science, Majoring in Statistics and mathmatical application in finance and economics from the University of Toronto in 2022. Yiqu earned her master degree in financial insurance from the University of Toronto in 2024.

## Code of ethical conduct

* We respect and protect confidential data obtained from, or relating to, clients and third parties, as well as personal data and information about about employees from Data Over Flow. We only share information when there is a business purpose, and then do so in accordance with applicable laws and professional standards.
*	We take proactive measures to safeguard our archives, computers and other data-storage devices containing confidential information or personal data. We promptly report any loss, damage or inapproprita disclosure of confidential information or personal data. 
* We use social media and technology in a responsible way and respect everyone we work with. We obtain, develop and protect intellectual capital in an appropriate manner. We respect the resrtictions on its use and reproduction. 